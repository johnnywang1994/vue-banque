# Vue Banque

`Vue Banque` is a mini state storage system for vue-next(vue3) which only with 1KB tiny size.



## Features

1. `1KB` tiny size.
2. `Banque Module` is ES6 destructurable, auto implemented `toRef` when destructuring.
3. `State Modify Protect` for states accessing from Banque Module.
4. `Cross Module Access` for access states between modules.



## Install

```bash
$ npm install vue-banque
```



## Usage

### Create Module

Create your first banque module, and easliy export with `export default`.

```js
// store/Game.js
import { ref } from 'vue';

const count = ref(0);

export default {
  count,
}
```


### Create Banque

Create `Vue Banque` with your modules

```js
// store/index.js
import { createBanque } from 'vue-banque';
import Game from './Game';

const banque = createBanque({
  modules: { Game },
});

export default banque;

// expose your custom hook by calling `banque.inject()`
export function useBanque() {
  // you can do something cool...
  // this will expose `banque.rootState`
  return banque.inject();
}
```


### Use Banque

Register your banque in Vue app

```js
// main.js
import { createApp } from 'vue';
import App from './App.vue';
import banque from './store';

createApp(App).use(banque).mount('#app');
```



### Use in setup

```html
<script setup>
import { useBanque } from '@/store';

const { Game } = useBanque();

// destructured items will auto implemented with `toRef`
const { count } = Game; // Ref
console.log(count.value);
</script>
```



### Access for states 

each module accessed from rootState will be protected with `readonly`. All property will be wrapped with `toRef` output, only function in module will be wrapped without `toRef`.

```js
import { useBanque } from '@/store';

const { Game } = useBanque();
const { count } = Game;

count.value += 1;
// warn: Set operation on key "value" failed: target is readonly.
```


### Define Action

functions in module will be wrapped with `rootState` as global context in first param, so we can access every modules by using it.

> Since the `rootState` context acts same behavior as in component setup function,
 we cant modify states directly, states will only be allowed to be modified in the module define scope.

```js
// store/Game.js
import { ref } from 'vue';

const count = ref(0);

// first param context will be auto generated by `Vue Banque`
function add(context, mystep = 1) {
  console.log(context); // { Game }
  count.value += mystep;
}

export default {
  count,
  add,
}
```


### Cross Module Demo

define a new module

```js
// store/index.js
import { createBanque } from 'vue-banque';
import Api from './Api';
import Game from './Game';

const banque = createBanque({
  modules: { Api, Game },
});

// ...
```

api module

```js
// store/Api.js
import { ref } from 'vue';

const APILoading = ref(false);

function updateAPILoading(context, bool) {
  APILoading.value = bool;
}

export default {
  APILoading,
  updateAPILoading,
}
```

game module

```js
// store/Game.js
import { ref } from 'vue';

const count = ref(0);

// first param context will be auto generated by `Vue Banque`
function add({ Api }, mystep = 1) {
  Api.updateAPILoading(true);
  count.value += mystep;
  Api.updateAPILoading(false);
}

export default {
  count,
  add,
}
```

use action in components

```html
<template>
  <p>Count: {{ count }}</p>
  <div @click="add(3)">ADD</div>
</template>

<script setup>
import { useBanque } from '@/store';

const { Game } = useBanque();

const { count, add } = Game;
</script>
```



## Use with optional API

the `$banque` stands for the global context.

```js
export default {
  mounted() {
    const { Game } = this.$banque;
    const { count, add } = Game;

    add();
    console.log(count.value);
  },
};
```



## Typescript Support

Since `Vue Banque` is writen by Typescript, so you can easily used with Typescript as following:


### Create Banque

```ts
// store/index.ts
import { createBanque, BanqueModule } from 'vue-banque';
import Game from './Game';

export type BanqueRoot = {
  Game: BanqueModule<typeof Game>,
}

const banque = createBanque<BanqueRoot>({
  modules: { Game },
});

export default banque;

export function useHookStore() {
  return banque.inject();
}
```


### Create Module

```ts
// store/Game.ts
import { ref } from 'vue';
import { BanqueRoot } from './index';

const count = ref<number>(0);

function add(context: BanqueRoot, mystep: number = 1): void {
  count.value += mystep;
}

export default {
  count,
  add,
}
```


## Last Updated

- 2021-08-21